{% extends 'template.html' %}

{% block page_title %}
G-COMM | GRID Server
{% endblock %}

{% block body %}
<!--Data Entry-->
<form onsubmit="return renderSubmission()">
    <input type="text" name="initials" value="" id='initialsSubmit' style="display: none"/>
    <!--Data Entry Table-->
    <div class="data-entry-container">
        <!-- LEFT SIDE -->
        <div class="data-entry-part">
            <!-- Brand Name -->
            <div class="data-entry-label-and-input">
                <p>Brand: </p>
                <input type="text" name="brand" value="" required>
            </div>
            <!-- Model Name -->
            <div class="data-entry-label-and-input">
                <p>Model: </p>
                <input type="text" name="model" value="" required>
            </div>
            <!-- Condition -->
            <div class="data-entry-label-and-input">
                <p>Condition: </p>
                <select name="condition" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="Computer Posts">Posts Successfully</option>
                    <option value="Powers On, No Post">Powers On, No Post</option>
                    <option value="Does Not Power On">Does Not Power On</option>
                    <option value="Untested">Untested (manager)</option>
                    <option value="Irreparable">Irreparable (manager)</option>
                </select>
            </div>
            <!-- Computer Type -->
            <div class="data-entry-label-and-input">
                <p>Computer: </p>
                <div class="radio-group" id="computer_type_rg">
                    <!-- Desktop -->
                    <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice1" name="computer_type" value="Desktop" required>
                        <label for="contactChoice1">Desktop</label>
                    </div>
                    <!-- Laptop -->
                    <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice2" name="computer_type" value="Laptop" required>
                        <label for="contactChoice2">Laptop</label>
                    </div>
                    <!-- All-In-One -->
                    <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice3" name="computer_type" value="All-In-One" required>
                        <label for="contactChoice3">All-In-One</label>
                    </div>
                    <!-- Maybe Add Chrome and other in the fture? -->
                    <!-- <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice4" name="computer_type" value="Chrome" required>
                        <label for="contactChoice4">Chrome</label>
                    </div>
                    <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice5" name="computer_type" value="Other" required>
                        <label for="contactChoice5">Other</label>
                    </div> -->
                </div>
            </div>
            <!-- Script for changing computer options based on type-->
            <script>
                document.querySelector('#computer_type_rg').addEventListener('click', function() {
                    switch (document.querySelector('input[name="computer_type"]:checked').value) {
                        case "Desktop":
                            //console.log('Desktop Chosen');
                            document.querySelector('#computer-options-placeholder').style.display = "none";
                            document.querySelector('#computer-options-desktop').style.display = "grid";
                            document.querySelector('#computer-options-laptop').style.display = "none";
                            document.querySelector('#computer-options-aio').style.display = "none";
                            break;
                        case "Laptop":
                            //console.log('Laptop Chosen');
                            document.querySelector('#computer-options-placeholder').style.display = "none";
                            document.querySelector('#computer-options-desktop').style.display = "none";
                            document.querySelector('#computer-options-laptop').style.display = "grid";
                            document.querySelector('#computer-options-aio').style.display = "none";
                            break;
                        case "All-In-One":
                            //console.log('AIO Chosen');
                            document.querySelector('#computer-options-placeholder').style.display = "none";
                            document.querySelector('#computer-options-desktop').style.display = "none";
                            document.querySelector('#computer-options-laptop').style.display = "none";
                            document.querySelector('#computer-options-aio').style.display = "grid";
                            break;
                        default:
                            alert('Something went wrong in selection');
                            document.querySelector('#computer-options-placeholder').style.display = "grid";
                            document.querySelector('#computer-options-desktop').style.display = "none";
                            document.querySelector('#computer-options-laptop').style.display = "none";
                            document.querySelector('#computer-options-aio').style.display = "none";
                    }
                });
                
            </script>
            <!-- DIVs for different screen/graphics things depending on computer type -->
            <div id='computer-options-placeholder'>
                <div class="data-entry-label-and-input">
                    <p>... </p>
                    <select name="placeholder" disabled>
                        <option value="" selected disabled hidden>Select A Computer...</option>
                    </select>
                </div>
                <div class="data-entry-label-and-input">
                    <p>... </p>
                    <select name="placeholder" disabled>
                        <option value="" selected disabled hidden>Select A Computer...</option>
                    </select>
                </div>
            </div>
            <div id='computer-options-desktop' style="display: none;">
                <div class="data-entry-label-and-input">
                    <p>Graphics: </p>
                    <select name="desktop_gpu_type" id="desktop_gpu_type_select">
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value="Integrated">Integrated</option>
                        <option value="Dedicated" onclick="promptGPUName(this)">Dedicated</option>
                        <option value="N/A" hidden>N/A</option>
                        <script>
                            function promptGPUName(element) {
                                let name = prompt('Please enter the name of the GPU');
                                if (!name) {
                                    element.parentElement.selectedIndex = 0;
                                    element.value = 'Dedicated';
                                } else {
                                    element.value = 'Dedicate - ' + name;
                                    element.innerHTML = 'Dedicated - ' + name;
                                }
                            }
                        </script>
                    </select>
                </div>
                <div class="data-entry-label-and-input">
                    <p>Tags:</p>
                    <div class="tags-select-container" id='desktop_video_ports'>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="VGA" id="tag-webcam">
                            <label class="form-check-label" for="flexCheckDefault"> VGA </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="DVI" id="tag-HDMI">
                            <label class="form-check-label" for="flexCheckDefault"> DVI </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="DMS" id="tag-touch">
                            <label class="form-check-label" for="flexCheckDefault"> DMS </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="DP" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> DP </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="HDMI" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> HDMI </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="Mini DP" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> Mini DP </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="Mini HDMI" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> Mini HD </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="USB-C" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> USB-C </label>
                        </div>
                    </div>
                </div>
            </div>
            <div id='computer-options-laptop' style='display: none;'>
                <div class="data-entry-label-and-input">
                    <p>Screen Cond:</p>
                    <select name="laptop_screen_condition" id = "laptop_screen_condition">
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value="Working">Working</option>
                        <option value="Cracked">Cracked</option>
                        <option value="Cracked (unusable)">Cracked (unusable)</option>
                        <option value="Dead Pixels">Dead Pixels</option>
                        <option value="Dead Pixels (unusable)">Dead Pixels (unusable)</option>
                        <option value="Dark Spots">Dark Spots</option>
                        <option value="Discolored">Discolored</option>
                        <option value="Dim">Dim</option>
                        <option value="Dead">Dead</option>
                        <option value="N/A" hidden >N/A</option>
                    </select>
                </div>
                <div class="data-entry-label-and-input">
                    <p>Screen Size: </p>
                    <select name="laptop_screen_size" id='laptop_screen_size'>
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value=-11>less than 11in.</option>
                        <option value=11>11 inches</option>
                        <option value=13>13 inches</option>
                        <option value=14>14 inches</option>
                        <option value=15>15 inches</option>
                        <option value=17>17 inches</option>
                        <option value=18>18 inches</option>
                        <option value=-100>greater than 18in.</option>
                        <option value=-1 hidden >N/A</option>
                    </select>
                </div>
            </div>
            <div id='computer-options-aio' style="display: none;">
                <div class="data-entry-label-and-input">
                    <p>Screen Cond:</p>
                    <select name="aio_screen_condition" id = "aio_screen_condition">
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value="Working">Working</option>
                        <option value="Cracked">Cracked</option>
                        <option value="Cracked (unusable)">Cracked (unusable)</option>
                        <option value="Dead Pixels">Dead Pixels</option>
                        <option value="Dead Pixels (unusable)">Dead Pixels (unusable)</option>
                        <option value="Dark Spots">Dark Spots</option>
                        <option value="Discolored">Discolored</option>
                        <option value="Dim">Dim</option>
                        <option value="Dead">Dead</option>
                        <option value="N/A" hidden >N/A</option>
                    </select>
                </div>
                <div class="data-entry-label-and-input">
                    <p>Screen Size: </p>
                    <select name="aio_screen_size" id='aio_screen_size'>
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value=-19>less than 19in.</option>
                        <option value=19>19 inches</option>
                        <option value=20>20 inches</option>
                        <option value=21>21 inches</option>
                        <option value=22>22 inches</option>
                        <option value=23>23 inches</option>
                        <option value=24>24 inches</option>
                        <option value=25>25 inches</option>
                        <option value=26>26 inches</option>
                        <option value=27>27 inches</option>
                        <option value=28>28 inches</option>
                        <option value=29>29 inches</option>
                        <option value=30>30 inches</option>
                        <option value=31>31 inches</option>
                        <option value=32>32 inches</option>
                        <option value=33>33 inches</option>
                        <option value=34>34 inches</option>
                        <option value=-100>greater than 34in.</option>
                        <option value=-1 hidden >N/A</option>
                    </select>
                </div>
            </div>
            <!-- Operating System -->
            <div class="data-entry-label-and-input">
                <p>OS: </p>
                <select name="os" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="N/A">N/A</option>
                    <option value="Windows 10 Home">Windows 10 Home</option>
                    <option value="Windows 10 Pro">Windows 10 Pro</option>
                    <option value="Windows 11 Home">Windows 11 Home</option>
                    <option value="Windows 11 Pro">Windows 11 Pro</option>
                    <option value="OSX 10.5">OSX 10.5</option>
                    <option value="OSX 10.6">OSX 10.6</option>
                    <option value="OSX 10.7">OSX 10.7</option>
                    <option value="OSX 10.8">OSX 10.8</option>
                    <option value="OSX 10.9">OSX 10.9</option>
                    <option value="OSX 10.10">OSX 10.10</option>
                    <option value="OSX 10.11">OSX 10.11</option>
                    <option value="OSX 10.12">OSX 10.12</option>
                    <option value="OSX 10.13">OSX 10.13</option>
                    <option value="OSX 10.14">OSX 10.14</option>
                    <option value="OSX 10.15">OSX 10.15</option>
                </select>
            </div>
        </div>


        <!--RIGHT SIDE (on desktop)-->
        <div class="data-entry-part">
            <!-- CPU Brand -->
            <div class="data-entry-label-and-input">
                <p>CPU Brand: </p>
                <select name="cpu-brand" id="cpu-brand-selector" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="Intel">Intel</option>
                    <option value="AMD">AMD</option>
                    <option value="Other" onclick='promptCPUBrand(this)'>Other</option>
                    <script>
                        function promptCPUBrand(element) {
                            let name = prompt('Please enter the name of the GPU');
                            if (!name) {
                                element.parentElement.selectedIndex = 0;
                                element.value = 'Other';
                            } else {
                                element.value = 'Other - ' + name;
                                element.innerHTML = 'Other - ' + name;
                            }
                        }
                    </script>
                </select>
            </div>
            <!-- CPU Model -->
            <div class="data-entry-label-and-input">
                <p>CPU Model: </p>
                <input type="text" name="cpu_model" value="" required>
            </div>

            <!-- CPU Speed -->
            <div class="data-entry-label-and-input">
                <p>CPU Speed: </p>
                <select name="cpu-speed" id="cpu-speed-selector" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="1.0">1.0</option>
                    <option value="1.1">1.1</option>
                    <option value="1.2">1.2</option>
                    <option value="1.3">1.3</option>
                    <option value="1.4">1.4</option>
                    <option value="1.5">1.5</option>
                    <option value="1.6">1.6</option>
                    <option value="1.7">1.7</option>
                    <option value="1.8">1.8</option>
                    <option value="1.9">1.9</option>
                    <option value="2.0">2.0</option>
                    <option value="2.1">2.1</option>
                    <option value="2.2">2.2</option>
                    <option value="2.3">2.3</option>
                    <option value="2.4">2.4</option>
                    <option value="2.5">2.5</option>
                    <option value="2.6">2.6</option>
                    <option value="2.7">2.7</option>
                    <option value="2.8">2.8</option>
                    <option value="2.9">2.9</option>
                    <option value="3.0">3.0</option>
                    <option value="3.1">3.1</option>
                    <option value="3.2">3.2</option>
                    <option value="3.3">3.3</option>
                    <option value="3.4">3.4</option>
                    <option value="3.5">3.5</option>
                    <option value="3.6">3.6</option>
                    <option value="3.7">3.7</option>
                    <option value="3.8">3.8</option>
                    <option value="3.9">3.9</option>
                    <option value="4.0">4.0</option>
                    <option value="4.1">4.1</option>
                    <option value="4.2">4.2</option>
                    <option value="4.3">4.3</option>
                    <option value="4.4">4.4</option>
                    <option value="4.5">4.5</option>
                    <option value="4.6">4.6</option>
                    <option value="4.7">4.7</option>
                    <option value="4.8">4.8</option>
                    <option value="4.9">4.9</option>
                    <option value="5.0">5.0</option>
                </select>
            </div>

            <!-- RAM -->
            <div class="data-entry-label-and-input">
                <p>RAM: </p>
                <select name="ram" id="ram-selector" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="less than 1GB">less than 1GB</option>
                    <option value="1GB">1GB</option>
                    <option value="2GB">2GB</option>
                    <option value="3GB">3GB</option>
                    <option value="4GB">4GB</option>
                    <option value="6GB">6GB</option>
                    <option value="8GB">8GB</option>
                    <option value="12GB">12GB</option>
                    <option value="16GB">16GB</option>
                    <option value="24GB">24GB</option>
                    <option value="32GB">32GB</option>
                </select>
            </div>

            <!-- HDD -->
            <div class="data-entry-label-and-input">
                <p>HDD Size: </p>
                <select name="hdd" id="hdd-selector" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="80GB">80GB</option>
                    <option value="120GB">120GB</option>
                    <option value="160GB">160GB</option>
                    <option value="250GB">250GB</option>
                    <option value="320GB">320GB</option>
                    <option value="500GB">500GB</option>
                    <option value="640GB">640GB</option>
                    <option value="750GB">750GB</option>
                    <option value="1.0TB">1.0TB</option>
                    <option value="1.5TB">1.5TB</option>
                    <option value="2.0TB">2.0TB</option>
                    <option value="3.0TB">3.0TB</option>
                    <option value="4.0TB">4.0TB</option>
                </select>
            </div>

            <!-- HDD Type -->
            <div class="data-entry-label-and-input">
                <p>HDD Type: </p>
                <div class="radio-group">
                    <!-- HDD -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice1" name="hdd_type" value="HDD" required>
                        <label for="contactChoice1">HDD</label>
                    </div>
                    <!-- SSD -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice2" name="hdd_type" value="SSD" required>
                        <label for="contactChoice2">SSD</label>
                    </div>
                    <!-- M.2 SSD -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice3" name="hdd_type" value="M.2 SSD" required>
                        <label for="contactChoice3">M.2 SSD</label>
                    </div>
                    <!-- NVME -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice4" name="hdd_type" value="NVME" required>
                        <label for="contactChoice2">NVME</label>
                    </div>
                    <!-- Embedded -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice5" name="hdd_type" value="Embedded" required>
                        <label for="contactChoice3">Embedded</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--Submission Section-->
    <div class="data-submission-container">
        <button name="button" class="btn" style="background-color: #aea;" id='submitButton'>Submit</button>
    </div>
    <!-- Submission modal container-->
    <div id='submission-modal-container'> 
        <div class="modal fade" id="submission_modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="submission-modal-title"></h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="submission-modal-body" class="modal-body">
                  
                </div>
                <div id="submission-modal-footer" class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" id="submission-modal-button" class="btn btn-primary">Submit</button>
                    <img id="loading-gif" src="static/img/loading.gif" style="display: none; width: 32px; height: 32px;"></img>
                </div>
              </div>
            </div>
        </div>
    </div>
    <!--Submission Script-->
    <script>
        function renderSubmission() {
            console.log('Button Clicked!');
            //get selected computer type
            let computer_type;
            document.getElementsByName('computer_type').forEach((item) => {
                if (item.checked) {
                    computer_type = item.value;
                }
            });
            //get selected computer type
            let computer_source;
            document.getElementsByName('source').forEach((item) => {
                if (item.checked) {
                    computer_source = item.value;
                }
            });
            //get tags
            let computer_tags = [];
            document.querySelectorAll('.form-check-input').forEach((item) => {
                //console.log(item)
                if (item.checked && item.type=="checkbox") {
                    if (item.id == "tag-second-drive") {
                        let drive_value = document.querySelector('#second-hdd-selector').value;
                        computer_tags.push(item.value + drive_value);
                    } else {
                        computer_tags.push(item.value);
                    }
                }
            });

            try {
                let submission = {
                    'old_coa': document.getElementsByName('old_coa')[0].value,
                    'new_coa': document.getElementsByName('new_coa')[0].value,
                    'serial_no': document.getElementsByName('serial_no')[0].value,
                    'brand': document.getElementsByName('brand')[0].value,
                    'model': document.getElementsByName('model')[0].value,
                    'os': document.getElementsByName('os')[0].value,
                    //computer_type
                    'computer_type': computer_type,
                    //computer_source
                    'source': computer_source,
                    'cpu_brand': document.getElementsByName('cpu-brand')[0].value,
                    'cpu_model': document.getElementsByName('cpu-type')[0].value,
                    'cpu_gen': document.getElementsByName('cpu-gen')[0].value,
                    'cpu_speed': document.getElementsByName('cpu-speed')[0].value,
                    'ram': document.getElementsByName('ram')[0].value,
                    'hdd': document.getElementsByName('hdd')[0].value,
                    'disk_drive': document.getElementsByName('disk-drive')[0].value,
                    //computer_tags
                    'tags': computer_tags
                };
                //console.log('JSON Data Rendered:\n' + JSON.stringify(submission));

                document.querySelector("#submission-modal-title").innerHTML = submission.brand + ' ' + submission.model + ' - Serial No.#'+submission.serial_no;
                document.querySelector("#submission-modal-body").innerHTML = submissionStringGenerator(submission);
                let submissionModalElement = document.getElementById('submission_modal');
                let submissionModal = new bootstrap.Modal(submissionModalElement);
                submissionModal.toggle();

                document.querySelector("#submission-modal-button").addEventListener('click', function() {
                    let techInitials = document.querySelector("#submission-modal-tech-input").value;
                    if (techInitials.length < 2)  {
                        document.querySelector("#tech-confirmer").style = "color: #f00; visibility: visible;";
                    } else {
                        this.style.display = "none";
                        document.querySelector("#loading-gif").style.display = "initial";
                        submission.tech = techInitials;
                        fetch('http://localhost:5000/syslogs', {method: 'POST', body: JSON.stringify(submission)})
                        .then(response => response.json())
                        .then(data => {
                            window.location.assign('syslogs');
                        })
                        .catch (error => {
                            this.style.display = "initial";
                            document.querySelector("#loading-gif").style.display = "none";
                            alert('An error occured.\n\nDetails: ' + error);
                            console.log(error);
                        });
                    }
                });
                //return false to cancel default form submission
                //instead relying on API call from submission modal
                return false;
            } catch (error) {
                console.log(error);
                return false;
            }
            return false;
        }
    
        //string generator for bootstrap modals
        function submissionStringGenerator(entry) {
            return '<p><b>Old COA: </b>' + entry.old_coa + '</p>' +
            '<p><b>New COA: </b>' + entry.new_coa + '</p>' +
            '<p><b>Serial No.: </b>' + entry.serial_no + '</p>' +
            '<p><b>Operating System: </b>' + entry.os + '</p>' +
            '<p><b>Computer Type: </b>' + entry.computer_type + '</p>' +
            '<p><b>Processor: </b>' + entry.cpu_brand + ' ' + entry.cpu_model + (entry.cpu_gen != null ? ' ' + entry.cpu_gen + ' - ' : ' - ') + entry.cpu_speed + 'Ghz' + '</p>' +
            '<p><b>RAM Amount: </b>' + entry.ram + '</p>' +
            '<p><b>Hard Drive: </b>' + entry.hdd + '</p>' +
            '<p><b>Disk Drive: </b>' + entry.disk_drive + '</p>' +
            '<p><b>Other Information: </b>' + entry.tags + '</p>' +
            '<p><b>Tech: </b> <input id="submission-modal-tech-input" type="text" placeholder="Initials here..."><span id="tech-confirmer" style="color: #f00; visibility: hidden;">&emsp;Please enter your initials</span></p>' +
            '';
        }
    </script>
</form>
{% endblock %}