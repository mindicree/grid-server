{% extends 'template.html' %}

{% block page_title %}
G-COMM | GRID Server
{% endblock %}

{% block body %}
<!--Data Entry-->
<form onsubmit="return renderSubmission()">
    <input type="text" name="initials" value="" id='initialsSubmit' style="display: none"/>
    <!--Data Entry Table-->
    <div class="data-entry-container">
        <!-- LEFT SIDE -->
        <div class="data-entry-part">
            <!-- Brand Name -->
            <div class="data-entry-label-and-input">
                <p>Brand: </p>
                <input type="text" name="brand" value="" placeholder="Dell, HP, Lenovo, etc." required>
            </div>
            <!-- Model Name -->
            <div class="data-entry-label-and-input">
                <p>Model: </p>
                <input type="text" name="model" value="" placeholder="ThinkPad, Optiplex, Stream, etc." required>
            </div>
            <!-- Condition -->
            <div class="data-entry-label-and-input">
                <p>Condition: </p>
                <select name="condition" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="Posts Sucessfully">Posts Successfully</option>
                    <option value="Powers On, No Post">Powers On, No Post</option>
                    <option value="Does Not Power On">Does Not Power On</option>
                    <option value="Untested">Untested (manager)</option>
                    <option value="Irreparable">Irreparable (manager)</option>
                </select>
            </div>
            <!-- Computer Type -->
            <div class="data-entry-label-and-input">
                <p>Computer: </p>
                <div class="radio-group" id="computer_type_rg">
                    <!-- Desktop -->
                    <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice1" name="computer_type" value="Desktop" required>
                        <label for="contactChoice1">Desktop</label>
                    </div>
                    <!-- Laptop -->
                    <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice2" name="computer_type" value="Laptop" required>
                        <label for="contactChoice2">Laptop</label>
                    </div>
                    <!-- All-In-One -->
                    <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice3" name="computer_type" value="All-In-One" required>
                        <label for="contactChoice3">All-In-One</label>
                    </div>
                    <!-- Maybe Add Chrome and other in the fture? -->
                    <!-- <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice4" name="computer_type" value="Chrome" required>
                        <label for="contactChoice4">Chrome</label>
                    </div>
                    <div class="radio-group-item">
                        <input type="radio" id="compTypeChoice5" name="computer_type" value="Other" required>
                        <label for="contactChoice5">Other</label>
                    </div> -->
                </div>
            </div>
            <!-- Script for changing computer options based on type-->
            <script>
                document.querySelector('#computer_type_rg').addEventListener('click', function() {
                    switch (document.querySelector('input[name="computer_type"]:checked').value) {
                        case "Desktop":
                            //console.log('Desktop Chosen');
                            document.querySelector('#computer-options-placeholder').style.display = "none";
                            document.querySelector('#computer-options-desktop').style.display = "grid";
                            document.querySelector('#computer-options-laptop').style.display = "none";
                            document.querySelector('#computer-options-aio').style.display = "none";
                            break;
                        case "Laptop":
                            //console.log('Laptop Chosen');
                            document.querySelector('#computer-options-placeholder').style.display = "none";
                            document.querySelector('#computer-options-desktop').style.display = "none";
                            document.querySelector('#computer-options-laptop').style.display = "grid";
                            document.querySelector('#computer-options-aio').style.display = "none";
                            break;
                        case "All-In-One":
                            //console.log('AIO Chosen');
                            document.querySelector('#computer-options-placeholder').style.display = "none";
                            document.querySelector('#computer-options-desktop').style.display = "none";
                            document.querySelector('#computer-options-laptop').style.display = "none";
                            document.querySelector('#computer-options-aio').style.display = "grid";
                            break;
                        default:
                            alert('Something went wrong in selection');
                            document.querySelector('#computer-options-placeholder').style.display = "grid";
                            document.querySelector('#computer-options-desktop').style.display = "none";
                            document.querySelector('#computer-options-laptop').style.display = "none";
                            document.querySelector('#computer-options-aio').style.display = "none";
                    }
                });
                
            </script>
            <!-- DIVs for different screen/graphics things depending on computer type -->
            <div id='computer-options-placeholder'>
                <div class="data-entry-label-and-input">
                    <p>... </p>
                    <select name="placeholder" disabled>
                        <option value="" selected disabled hidden>Select A Computer...</option>
                    </select>
                </div>
                <div class="data-entry-label-and-input">
                    <p>... </p>
                    <select name="placeholder" disabled>
                        <option value="" selected disabled hidden>Select A Computer...</option>
                    </select>
                </div>
            </div>
            <div id='computer-options-desktop' style="display: none;">
                <div class="data-entry-label-and-input">
                    <p>Graphics: </p>
                    <select name="desktop_gpu_type" id="desktop_gpu_type_select">
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value="Integrated">Integrated</option>
                        <option value="Dedicated" onclick="promptGPUName(this)">Dedicated</option>
                        <option value="N/A" hidden>N/A</option>
                        <script>
                            function promptGPUName(element) {
                                let name = prompt('Please enter the name of the GPU');
                                if (!name) {
                                    element.parentElement.selectedIndex = 0;
                                    element.value = 'Dedicated';
                                } else {
                                    element.value = 'Dedicate - ' + name;
                                    element.innerHTML = 'Dedicated - ' + name;
                                }
                            }
                        </script>
                    </select>
                </div>
                <div class="data-entry-label-and-input">
                    <p>Video Ports:</p>
                    <div class="tags-select-container" id='desktop_video_ports'>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="VGA" id="tag-webcam">
                            <label class="form-check-label" for="flexCheckDefault"> VGA </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="DVI" id="tag-HDMI">
                            <label class="form-check-label" for="flexCheckDefault"> DVI </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="DMS" id="tag-touch">
                            <label class="form-check-label" for="flexCheckDefault"> DMS </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="DP" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> DP </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="HDMI" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> HDMI </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="Mini DP" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> Mini DP </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="Mini HDMI" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> Mini HD </label>
                        </div>
                        <div class="tags-option">
                            <input class="form-check-input" type="checkbox" value="USB-C" id="tag-SSD">
                            <label class="form-check-label" for="flexCheckDefault"> USB-C </label>
                        </div>
                    </div>
                </div>
            </div>
            <div id='computer-options-laptop' style='display: none;'>
                <div class="data-entry-label-and-input">
                    <p>Screen Size: </p>
                    <select name="laptop_screen_size" id='laptop_screen_size'>
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value=-11>less than 11in.</option>
                        <option value=11>11 inches</option>
                        <option value=13>13 inches</option>
                        <option value=14>14 inches</option>
                        <option value=15>15 inches</option>
                        <option value=17>17 inches</option>
                        <option value=18>18 inches</option>
                        <option value=-100>greater than 18in.</option>
                        <option value=-1 hidden >N/A</option>
                    </select>
                </div>
                <div class="data-entry-label-and-input">
                    <p>Screen Cond:</p>
                    <select name="laptop_screen_condition" id = "laptop_screen_condition">
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value="Working">Working</option>
                        <option value="Cracked">Cracked</option>
                        <option value="Cracked (unusable)">Cracked (unusable)</option>
                        <option value="Dead Pixels">Dead Pixels</option>
                        <option value="Dead Pixels (unusable)">Dead Pixels (unusable)</option>
                        <option value="Dark Spots">Dark Spots</option>
                        <option value="Discolored">Discolored</option>
                        <option value="Dim">Dim</option>
                        <option value="Dead">Dead</option>
                        <option value="N/A" hidden >N/A</option>
                    </select>
                </div>
            </div>
            <div id='computer-options-aio' style="display: none;">
                <div class="data-entry-label-and-input">
                    <p>Screen Size: </p>
                    <select name="aio_screen_size" id='aio_screen_size'>
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value=-19>less than 19in.</option>
                        <option value=19>19 inches</option>
                        <option value=20>20 inches</option>
                        <option value=21>21 inches</option>
                        <option value=22>22 inches</option>
                        <option value=23>23 inches</option>
                        <option value=24>24 inches</option>
                        <option value=25>25 inches</option>
                        <option value=26>26 inches</option>
                        <option value=27>27 inches</option>
                        <option value=28>28 inches</option>
                        <option value=29>29 inches</option>
                        <option value=30>30 inches</option>
                        <option value=31>31 inches</option>
                        <option value=32>32 inches</option>
                        <option value=33>33 inches</option>
                        <option value=34>34 inches</option>
                        <option value=-100>greater than 34in.</option>
                        <option value=-1 hidden >N/A</option>
                    </select>
                </div>
                <div class="data-entry-label-and-input">
                    <p>Screen Cond:</p>
                    <select name="aio_screen_condition" id = "aio_screen_condition">
                        <option value="" selected disabled hidden>Select One...</option>
                        <option value="Working">Working</option>
                        <option value="Cracked">Cracked</option>
                        <option value="Cracked (unusable)">Cracked (unusable)</option>
                        <option value="Dead Pixels">Dead Pixels</option>
                        <option value="Dead Pixels (unusable)">Dead Pixels (unusable)</option>
                        <option value="Dark Spots">Dark Spots</option>
                        <option value="Discolored">Discolored</option>
                        <option value="Dim">Dim</option>
                        <option value="Dead">Dead</option>
                        <option value="N/A" hidden >N/A</option>
                    </select>
                </div>
            </div>
            <!-- Operating System -->
            <div class="data-entry-label-and-input">
                <p>OS: </p>
                <select name="os" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="N/A">N/A</option>
                    <option value="Windows 10 Home">Windows 10 Home</option>
                    <option value="Windows 10 Pro">Windows 10 Pro</option>
                    <option value="Windows 11 Home">Windows 11 Home</option>
                    <option value="Windows 11 Pro">Windows 11 Pro</option>
                    <option value="OSX 10.5">OSX 10.5</option>
                    <option value="OSX 10.6">OSX 10.6</option>
                    <option value="OSX 10.7">OSX 10.7</option>
                    <option value="OSX 10.8">OSX 10.8</option>
                    <option value="OSX 10.9">OSX 10.9</option>
                    <option value="OSX 10.10">OSX 10.10</option>
                    <option value="OSX 10.11">OSX 10.11</option>
                    <option value="OSX 10.12">OSX 10.12</option>
                    <option value="OSX 10.13">OSX 10.13</option>
                    <option value="OSX 10.14">OSX 10.14</option>
                    <option value="OSX 10.15">OSX 10.15</option>
                </select>
            </div>
        </div>


        <!--RIGHT SIDE (on desktop)-->
        <div class="data-entry-part">
            <!-- CPU Brand -->
            <div class="data-entry-label-and-input">
                <p>CPU Brand: </p>
                <select name="cpu-brand" id="cpu-brand-selector" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="Intel">Intel</option>
                    <option value="AMD">AMD</option>
                    <option value="Other" onclick='promptCPUBrand(this)'>Other</option>
                    <script>
                        function promptCPUBrand(element) {
                            let name = prompt('Please enter the name of the GPU');
                            if (!name) {
                                element.parentElement.selectedIndex = 0;
                                element.value = 'Other';
                            } else {
                                element.value = 'Other - ' + name;
                                element.innerHTML = 'Other - ' + name;
                            }
                        }
                    </script>
                </select>
            </div>
            <!-- CPU Model -->
            <div class="data-entry-label-and-input">
                <p>CPU Model: </p>
                <input type="text" name="cpu_model" value="" placeholder="Core i5, Ryzen 3, Pentium, etc." required>
            </div>

            <!-- CPU Speed -->
            <div class="data-entry-label-and-input">
                <p>CPU Speed: </p>
                <select name="cpu-speed" id="cpu-speed-selector" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="-1">Unknown</option>
                    <option value="1.0">1.0</option>
                    <option value="1.1">1.1</option>
                    <option value="1.2">1.2</option>
                    <option value="1.3">1.3</option>
                    <option value="1.4">1.4</option>
                    <option value="1.5">1.5</option>
                    <option value="1.6">1.6</option>
                    <option value="1.7">1.7</option>
                    <option value="1.8">1.8</option>
                    <option value="1.9">1.9</option>
                    <option value="2.0">2.0</option>
                    <option value="2.1">2.1</option>
                    <option value="2.2">2.2</option>
                    <option value="2.3">2.3</option>
                    <option value="2.4">2.4</option>
                    <option value="2.5">2.5</option>
                    <option value="2.6">2.6</option>
                    <option value="2.7">2.7</option>
                    <option value="2.8">2.8</option>
                    <option value="2.9">2.9</option>
                    <option value="3.0">3.0</option>
                    <option value="3.1">3.1</option>
                    <option value="3.2">3.2</option>
                    <option value="3.3">3.3</option>
                    <option value="3.4">3.4</option>
                    <option value="3.5">3.5</option>
                    <option value="3.6">3.6</option>
                    <option value="3.7">3.7</option>
                    <option value="3.8">3.8</option>
                    <option value="3.9">3.9</option>
                    <option value="4.0">4.0</option>
                    <option value="4.1">4.1</option>
                    <option value="4.2">4.2</option>
                    <option value="4.3">4.3</option>
                    <option value="4.4">4.4</option>
                    <option value="4.5">4.5</option>
                    <option value="4.6">4.6</option>
                    <option value="4.7">4.7</option>
                    <option value="4.8">4.8</option>
                    <option value="4.9">4.9</option>
                    <option value="5.0">5.0</option>
                </select>
            </div>

            <!-- RAM -->
            <div class="data-entry-label-and-input">
                <p>RAM: </p>
                <select name="ram" id="ram-selector" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="N/A">N/A</option>
                    <option value="less than 1GB">less than 1GB</option>
                    <option value="1GB">1GB</option>
                    <option value="2GB">2GB</option>
                    <option value="3GB">3GB</option>
                    <option value="4GB">4GB</option>
                    <option value="6GB">6GB</option>
                    <option value="8GB">8GB</option>
                    <option value="12GB">12GB</option>
                    <option value="16GB">16GB</option>
                    <option value="24GB">24GB</option>
                    <option value="32GB">32GB</option>
                </select>
            </div>

            <!-- HDD -->
            <div class="data-entry-label-and-input">
                <p>HDD Size: </p>
                <select name="hdd" id="hdd-selector" required>
                    <option value="" selected disabled hidden>Select One...</option>
                    <option value="N/A">N/A</option>
                    <option value="80GB">80GB</option>
                    <option value="120GB">120GB</option>
                    <option value="160GB">160GB</option>
                    <option value="250GB">250GB</option>
                    <option value="320GB">320GB</option>
                    <option value="500GB">500GB</option>
                    <option value="640GB">640GB</option>
                    <option value="750GB">750GB</option>
                    <option value="1.0TB">1.0TB</option>
                    <option value="1.5TB">1.5TB</option>
                    <option value="2.0TB">2.0TB</option>
                    <option value="3.0TB">3.0TB</option>
                    <option value="4.0TB">4.0TB</option>
                </select>
            </div>

            <!-- HDD Type -->
            <div class="data-entry-label-and-input">
                <p>HDD Type: </p>
                <div class="radio-group">
                    <!-- HDD -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice1" name="hdd_type" value="HDD" required>
                        <label for="contactChoice1">HDD</label>
                    </div>
                    <!-- SSD -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice2" name="hdd_type" value="SSD" required>
                        <label for="contactChoice2">SSD</label>
                    </div>
                    <!-- M.2 SSD -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice3" name="hdd_type" value="M.2 SSD" required>
                        <label for="contactChoice3">M.2 SSD</label>
                    </div>
                    <!-- NVME -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice4" name="hdd_type" value="NVME" required>
                        <label for="contactChoice2">NVME</label>
                    </div>
                    <!-- Embedded -->
                    <div class="radio-group-item">
                        <input type="radio" id="hddTypeChoice5" name="hdd_type" value="Embedded" required>
                        <label for="contactChoice3">Embedded</label>
                    </div>
                </div>
            </div>

            <!-- Notes -->
            <div class="data-entry-label-and-input">
                <p>Notes: </p>
                <input type="text" name="notes" placeholder="Bad battery, Cracked frame, etc." value="">
            </div>
        </div>
    </div>

    <!--Submission Section-->
    <div class="data-submission-container">
        <button name="button" class="btn" style="background-color: #aea;" id='submitButton'>Submit</button>
    </div>
    <!-- Submission modal container-->
    <div id='submission-modal-container'> 
        <div class="modal fade" id="submission_modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="submission-modal-title"></h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="submission-modal-body" class="modal-body">
                  
                </div>
                <div id="submission-modal-footer" class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" id="submission-modal-button" class="btn btn-primary">Submit</button>
                    <img id="loading-gif" src="static/img/loading.gif" style="display: none; width: 32px; height: 32px;"></img>
                </div>
              </div>
            </div>
        </div>
    </div>
    <!--Submission Script-->
    <script>
        function renderSubmission() {
            console.log('Button Clicked!');
            //get selected computer type
            let computer_type;
            document.getElementsByName('computer_type').forEach((item) => {
                if (item.checked) {
                    computer_type = item.value;
                }
            });
            //get display ports
            let desktop_display_ports = [];
            document.querySelectorAll('.form-check-input').forEach((item) => {
                //console.log(item)
                if (item.checked && item.type=="checkbox") {
                    desktop_display_ports.push(item.value);
                }
            });
            //get selected HDD type
            let hdd_type;
            document.getElementsByName('hdd_type').forEach((item) => {
                if (item.checked) {
                    hdd_type = item.value;
                }
            });

            try {
                let submission = {
                    'brand': document.getElementsByName('brand')[0].value,
                    'model': document.getElementsByName('model')[0].value,
                    'condition': document.getElementsByName('condition')[0].value,
                    //computer_type
                    'computer_type': computer_type,
                    //computer type values
                    'laptop_screen_condition': (computer_type != 'Laptop' ? 'N/A' : document.getElementsByName('laptop_screen_condition')[0].value),
                    'laptop_screen_size': (computer_type != 'Laptop' ? -1 : document.getElementsByName('laptop_screen_size')[0].value),
                    'desktop_gpu_type': (computer_type != 'Desktop' ? 'N/A' : document.getElementsByName('desktop_gpu_type')[0].value),
                    'desktop_display_ports': (computer_type != 'Desktop' ? [] : desktop_display_ports),
                    'aio_screen_condition': (computer_type != 'All-In-One' ? 'N/A' : document.getElementsByName('aio_screen_condition')[0].value),
                    'aio_screen_size': (computer_type != 'All-In-One' ? -1 : document.getElementsByName('aio_screen_size')[0].value),
                    'os': document.getElementsByName('os')[0].value,
                    'cpu_brand': document.getElementsByName('cpu-brand')[0].value,
                    'cpu_model': document.getElementsByName('cpu_model')[0].value,
                    'cpu_speed': document.getElementsByName('cpu-speed')[0].value,
                    'ram': document.getElementsByName('ram')[0].value,
                    'hdd': document.getElementsByName('hdd')[0].value,
                    'hdd_type': hdd_type,
                    'notes': document.getElementsByName('notes')[0].value
                };
                console.log('JSON Data Rendered:\n' + JSON.stringify(submission));

                document.querySelector("#submission-modal-title").innerHTML = submission.brand + ' ' + submission.model;
                document.querySelector("#submission-modal-body").innerHTML = submissionStringGenerator(submission);
                let submissionModalElement = document.getElementById('submission_modal');
                let submissionModal = new bootstrap.Modal(submissionModalElement);
                submissionModal.toggle();

                document.querySelector("#submission-modal-button").addEventListener('click', function() {
                    let techInitials = document.querySelector("#submission-modal-tech-input").value;
                    if (techInitials.length < 2)  {
                        document.querySelector("#tech-confirmer").style = "color: #f00; visibility: visible;";
                    } else {
                        this.style.display = "none";
                        document.querySelector("#loading-gif").style.display = "initial";
                        submission.tech = techInitials;
                        fetch('http://localhost:5000/gcommlogs', {method: 'POST', body: JSON.stringify(submission)})
                        .then(response => response.json())
                        .then(data => {
                            window.location.assign('gcomm');
                        })
                        .catch (error => {
                            this.style.display = "initial";
                            document.querySelector("#loading-gif").style.display = "none";
                            alert('An error occured.\n\nDetails: ' + error);
                            console.log(error);
                        });
                    }
                });
                //return false to cancel default form submission
                //instead relying on API call from submission modal
                return false;
            } catch (error) {
                console.log(error);
                return false;
            }
            return false;
        }
    
        //string generator for bootstrap modals
        function submissionStringGenerator(entry) {
            let type_text, screenSize;
            switch (entry.computer_type) {
                case 'Desktop':
                    type_text = '' +
                        '<p><b>Graphics Type: </b>' + entry.desktop_gpu_type + '</p>' + 
                        '<p><b>Display Ports: </b>' + entry.desktop_display_ports + '</p>' + 
                        '';
                    break;
                case 'Laptop':
                    if (entry.laptop_screen_size == -11) {
                        screenSize = 'less than 11';
                    } else if (entry.laptop_screen_size == -100) {
                        screenSize = 'greater than 18';
                    } else {
                        screenSize = entry.laptop_screen_size;
                    }
                    type_text = '' +
                        '<p><b>Screen Size: </b>' + screenSize+ ' inches</p>' + 
                        '<p><b>Screen Condition: </b>' + entry.laptop_screen_condition + '</p>' + 
                        '';
                    break;
                case 'All-In-One':
                    if (entry.aio_screen_size == -19) {
                        screenSize = 'less than 19';
                    } else if (entry.aio_screen_size == -100) {
                        screenSize = 'greater than 34';
                    } else {
                        screenSize = entry.aio_screen_size;
                    }
                    type_text = '' +
                        '<p><b>Screen Size: </b>' + screenSize+ ' inches</p>' + 
                        '<p><b>Screen Condition: </b>' + entry.aio_screen_condition + '</p>' + 
                        '';
                    break;
                default:
                    console.log('Something went wrong. Please contact developer.');
            }
            return '' +
            '<p><b>Computer Type: </b>' + entry.computer_type + '</p>' +
            type_text + 
            '<p><b>Operating System: </b>' + entry.os + '</p>' +
            '<p><b>Processor: </b>' + entry.cpu_brand + ' ' + entry.cpu_model + ' ' + (entry.cpu_speed != -1 ? '- ' + entry.cpu_speed + 'Ghz' : '(Unknown Speed)') + '</p>' +
            '<p><b>RAM Amount: </b>' + entry.ram + '</p>' +
            '<p><b>Hard Drive: </b>' + entry.hdd + ' ' + entry.hdd_type + '</p>' +
            '<p><b>Notes: </b>' + (entry.notes.length <= 0 ? 'N/A' : entry.notes) + '</p>' +
            '<p><b>Tech: </b> <input id="submission-modal-tech-input" type="text" placeholder="Initials here..."><span id="tech-confirmer" style="color: #f00; visibility: hidden;">&emsp;Please enter your initials</span></p>' +
            '';
        }
    </script>
</form>

<!--Information Table-->
<table class="table table-striped table-hover table-bordered" id='tableGCommList' >
    <thead>
        <tr>
        <th>Date</th>
        <th>Model</th>
        <th>Options</th>
        </tr>
    </thead>
    <tbody id='tableGCommListBody'>

    </tbody>
</table>

<!--Loading Thing-->
<div id='table-loading-indicator' style='display: grid; width: 100%; margin: auto;'>
    <img src='static/img/loading.gif' style='width: 64px; height: 64px; margin: auto;'>
    <h4 style="color: #aaa; margin: auto;">Loading</h4>
</div>

<!--Pagination-->
<nav style="width: 50%; margin: auto;">
    <ul id='system-log-table-pagination' class="pagination pagination-sm justify-content-center">
    </ul>
</nav>

<!--Entry Modal-->
<div class="" id='tableModalContainer'>
    <div class="modal fade" id="modal-system-viewer">

    </div>
</div>

<!-- CALL TO API AND FILL TABLE -->
<script>
    //global variable for accessing system logs from API call
    let systems;
    //global page number for rendering the right tables
    let currentPage = 1;
    //global pagination values
    //pagination calculations
    let numRowsPerPage = 10;
    let numTotalRows;
    let numTotalPages;
    //function to add data to modal system viewer
    function renderSystemModal(row_id) {
        //console.log('renderSystemModal called with HTML ID: ' + row_id);
        let systemIdForDisplay = row_id.replace('table-row-', "");
        //console.log(systemIdForDisplay);
        let element;
        systems.forEach(e => {
            if (e._id === systemIdForDisplay) {
                element = e;
            }
        });
        //console.log('Element info for display: ' + JSON.stringify(element));
        //return 1;
        //create modal
        tableModal = document.querySelector('#modal-system-viewer');
        tableModal.innerHTML =
        '<div class="modal-dialog modal-xl">' +
            '<div class="modal-content">' +
                '<div class="modal-header">' +
                    '<h5 class="modal-title">'+element.brand + ' ' + element.model + ' - '+formatDateString(element.dt_initial_irl_log)+'</h5>' +
                    '<button id="system-modal-close-'+element._id+'" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>' +
                '</div>' +
                '<div class="modal-body">' +
                        entryStringGenerator(element) +
                '</div>' +
                '<div class="modal-footer justify-content-between">' +
                    '<button id="edit-btn-delete-'+element._id+'"type="button" class="btn btn-danger" style="visibility: hidden;" onclick="deleteSystemLog(this)">Delete</button>' +
                    '<div>' + 
                        '<button id="edit-btn-close-'+element._id+'"type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>' +
                        '<button id="edit-btn-'+element._id+'" type="button" class="btn btn-primary" style="margin-left: 10px;">Edit</button>' +
                        '<button id="edit-btn-cancel-'+element._id+'"type="button" class="btn btn-secondary" style="display: none;">Cancel</button>' +
                        '<button id="edit-btn-submit-'+element._id+'" type="button" class="btn btn-primary" style="display: none; margin-left: 10px;">Submit</button>' +
                    '</div>' +
                '</div>' +
            '</div>' +
        '</div>' +
        '';

        //add edit button functionalities
        document.querySelector('#edit-btn-'+element._id).addEventListener('click', function() {
            this.style.display = "none";
            document.querySelector('#edit-btn-close-'+element._id).style.display = "none";
            document.querySelector('#system-modal-data-'+element._id).style.display = "none";
            document.querySelector('#edit-btn-cancel-'+element._id).style.display = "initial";
            document.querySelector('#edit-btn-submit-'+element._id).style.display = "initial";
            document.querySelector('#edit-btn-delete-'+element._id).style.visibility = "visible";
            document.querySelector('#system-modal-data-edit-'+element._id).style.display = "grid";
        });
        document.querySelector('#edit-btn-cancel-'+element._id).addEventListener('click', function() {
            this.style.display = "none";
            document.querySelector('#edit-btn-close-'+element._id).style.display = "initial";
            document.querySelector('#system-modal-data-'+element._id).style.display = "grid";
            document.querySelector('#edit-btn-cancel-'+element._id).style.display = "none";
            document.querySelector('#edit-btn-submit-'+element._id).style.display = "none";
            document.querySelector('#edit-btn-delete-'+element._id).style.visibility = "hidden";
            document.querySelector('#system-modal-data-edit-'+element._id).style.display = "none";
            document.querySelector('#edit-btn-'+element._id).style.display = "initial";
        });
        document.querySelector('#edit-btn-submit-'+element._id).addEventListener('click', function() {
            //console.log('TODO: complete U functionality');
            document.querySelector('#edit-button-submit-trigger-'+element._id).click();
        });

        let myModal = new bootstrap.Modal(document.getElementById('modal-system-viewer'))
        myModal.toggle();
    }
    
    //function to changePage
    function changePage(pageBtn) {
        //console.log('Page ID: ' + pageBtn.id);
        let pageNum = pageBtn.id.replace('system-log-page-', '');
        //console.log('Page number clicked: ' + pageNum);
        if (Number.isInteger(Number.parseInt(pageNum))) {
            currentPage = pageNum;
        } else {
            if (pageNum === 'prev') {
                currentPage--;
            } else if (pageNum === 'next') {
                currentPage++;
            } else if (pageNum === 'elipses-left') {
                currentPage = Number.parseInt(currentPage/2);
            } else if (pageNum === 'elipses-right') {
                currentPage = Number.parseInt(currentPage) + Number.parseInt((numTotalPages-currentPage)/2);
            } else {
                currentPage = Number.parseInt(numTotalPages/2);
            }
        }
        renderPagination(currentPage);
        renderTablePage(currentPage);
    }

    //function to render data into table
    function renderTablePage(num) {
        //console.log('TODO render table with new page number ' + num);
        //clear table
        let tbody = document.querySelector('#tableStockListBody');
        tbody.innerHTML = "";
        //load new data into table
        //console.log('Page number recieved' + num);
        for (let i = numRowsPerPage * (num - 1); i < numRowsPerPage * num; i++) {
            try {
                let tableEntry = document.createElement('tr');
                tableEntry.id = 'table-row-'+systems[i]._id;
                tableEntry.innerHTML =
                "<th>" + formatDateString(systems[i].dt_initial_irl_log) + "</th>" +
                "<th>" + systems[i].brand + " " + systems[i].model + " (" + systems[i].computer_type + ")" + "</th>" +
                "<th>$" + systems[i].price.toFixed(2) + "</th>" +
                //"<th><div class='tableStockListButtonContainer'><button id='infoBtn' class='btn' data-bs-toggle='modal' data-bs-target='#id-"+element._id+"'>Info</button><button class='btn'>Edit</button><button class='btn'>Print</button></div></th>" +
                "<th><div class='tableStockListButtonContainer'><button id='infoBtn' class='btn'>Info</button><button class='btn'>Print</button></div></th>" +
                "";
                //add row click functionality to show information
                tableEntry.addEventListener('click', function() {
                    renderSystemModal(this.id);
                    //this.querySelector('#infoBtn').click();
                });
                tableEntry.setAttribute('class', 'align-middle');
                //add entry to table
                tbody.appendChild(tableEntry);
            } catch (error) {
                console.log(error);
            }
        }
    }

    //function to render pagination
    function renderPagination(num) {
        //get pagination
        let pagination = document.querySelector('#system-log-table-pagination');
        //clear pagination
        pagination.innerHTML = "";
        //add prev to pagination if not available
        pagination.innerHTML += '<li class="page-item '+(num == 1 ? 'disabled' : '') +'"><a id="system-log-page-prev" onclick="changePage(this)"class="page-link"'+(num != 1 ? 'style="background-color: var(--green); border: solid 1px var(--green);"' : '')+'>Prev</a></li>'
        //add pagination
        if (numTotalPages <= 8) {
            for (let i = 1; i <= numTotalPages; i++) {
                pagination.innerHTML += '<li class="page-item '+(num == i ? 'active' : '')+'" ><a class="page-link" id="system-log-page-'+i+'" onclick="changePage(this)">'+i+'</a></li>'; 
            }
        } else {
            if (num <= 4 || num >= numTotalPages - 3) {
                // 1 2 3 ... 98 99 100 N
                for (let i = 1; i <=4; i++) {
                    try {
                        pagination.innerHTML += '<li class="page-item '+(num == i ? 'active' : '')+'" ><a class="page-link" id="system-log-page-'+i+'" onclick="changePage(this)">'+i+'</a></li>'; 
                    } catch (error) {
                        console.log(error);
                    }  
                }
                pagination.innerHTML += '<li class="page-item" ><a class="page-link" id="system-log-page-elipses" onclick="changePage(this)">...</a></li>';   
                for (let i = numTotalPages - 3; i <=numTotalPages; i++) {
                    try {
                        pagination.innerHTML += '<li class="page-item '+(num == i ? 'active' : '')+'" ><a class="page-link" id="system-log-page-'+i+'" onclick="changePage(this)">'+i+'</a></li>';   
                    } catch (error) {
                        console.log(error);
                    }
                }
            } else {
                //P 1 ... 49 50 51 ... 100
                pagination.innerHTML += '<li class="page-item" ><a class="page-link" id="system-log-page-1" onclick="changePage(this)">1</a></li>'; 
                pagination.innerHTML += '<li class="page-item" ><a class="page-link" id="system-log-page-elipses-left" onclick="changePage(this)">...</a></li>'; 
                //console.log('Num given: ' + num);
                //console.log('Num range: (' + (num-2) + ', ' + (num+2) + ')')
                for (let i = Number.parseInt(num)-2; i <= Number.parseInt(num)+2; i++) {
                    //console.log('Current Value of i: ' + i)
                    pagination.innerHTML += '<li class="page-item '+(num == i ? 'active' : '')+'" ><a class="page-link" id="system-log-page-'+i+'" onclick="changePage(this)">'+i+'</a></li>';
                }
                pagination.innerHTML += '<li class="page-item" ><a class="page-link" id="system-log-page-elipses-right" onclick="changePage(this)">...</a></li>';   
                pagination.innerHTML += '<li class="page-item" ><a class="page-link" id="system-log-page-1" onclick="changePage(this)">'+numTotalPages+'</a></li>';
            }
        }
        
        
        //add next
        pagination.innerHTML += '<li class="page-item '+(num == numTotalPages ? 'disabled' : '') +'"><a id="system-log-page-next" onclick="changePage(this)"class="page-link"'+(num != numTotalPages ? 'style="background-color: var(--green); border: solid 1px var(--green);"' : '')+'>Next</a></li>'
    }

    //function to format date for data
    function formatDateString(dateString) {
        date = new Date(dateString);
        dateFormat = {
            weekday: 'short',
            day: 'numeric',
            month: 'short',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        }
        return date.toLocaleDateString('en-UK', dateFormat);
    }

    //fetch system log data from backend API
    fetch('http://localhost:5000/gcommlogs')
    .then(response => response.json())
    .then(data => {
        //assign data to global variable
        systems = data.reverse();
        //pagination calculations
        numTotalRows = systems.length;
        numTotalPages = parseInt(numTotalRows/numRowsPerPage);
        let index = 0;
        //get table HTML elements and create dynamic table row for each entry
        let tableBody = document.querySelector('#tableGCommListBody');
        let tableModalContainer = document.querySelector('#tableModalContainer');
        let tableEntry;
        //load data into table (reverse order for latest entry to first entry)
        systems.forEach(element => {
            //create table entry
            if (index < numRowsPerPage) {
                tableEntry = document.createElement('tr');
                tableEntry.id = 'table-row-'+element._id;
                tableEntry.innerHTML =
                "<th>" + formatDateString(element.dt_initial_irl_log) + "</th>" +
                "<th>" + element.brand + " " + element.model + " (" + element.computer_type + ")" + "</th>" +
                //"<th><div class='tableStockListButtonContainer'><button id='infoBtn' class='btn' data-bs-toggle='modal' data-bs-target='#id-"+element._id+"'>Info</button><button class='btn'>Edit</button><button class='btn'>Print</button></div></th>" +
                "<th><div class='tableStockListButtonContainer'><button id='infoBtn' class='btn'>Info</button><button class='btn'>Print</button></div></th>" +
                "";
                //add row click functionality to show information
                tableEntry.addEventListener('click', function() {
                    renderSystemModal(this.id);
                    //this.querySelector('#infoBtn').click();
                });
                tableEntry.setAttribute('class', 'align-middle');
                //add entry to table
                tableBody.appendChild(tableEntry);
                index++;
            }
        })
        //load pagination
        renderPagination(1);
        //make loading indicator disappear
        document.querySelector('#table-loading-indicator').style.display = "none";
    })
    .catch(error => console.log(error));

    //string generator for bootstrap modals
    function entryStringGenerator(entry) {
        let static_data= 
        '<div id="system-modal-data-'+entry._id+'"class="system-modal-data">' + 
            '<p><b>Condition: </b>' + entry.condition + '</p>' +
            '<p><b>Computer Type: </b>' + entry.computer_type + '</p>' +

            (entry.computer_type == 'Desktop' ? '<p><b>Graphics: </b>' + entry.desktop_gpu_type + '</p>' : '') +
            (entry.computer_type == 'Desktop' ? '<p><b>Video Ports: </b>' + entry.desktop_display_ports + '</p>' : '') +
            (entry.computer_type == 'Laptop' ? '<p><b>Screen Size: </b>' + (entry.laptop_screen_size < 0 ? (entry.laptop_screen_size == -100 ? 'greater than 18 inches' : 'less than 11 inches') : entry.laptop_screen_size + ' inches') + '</p>' : '') +
            (entry.computer_type == 'Laptop' ? '<p><b>Screen Condition: </b>' + entry.laptop_screen_condition + '</p>' : '') +
            (entry.computer_type == 'All-In-One' ? '<p><b>Screen Size: </b>' + (entry.aio_screen_size < 0 ? (entry.aio_screen_size == -100 ? 'greater than 34 inches' : 'less than 19 inches') : entry.aio_screen_size + ' inches') + '</p>' : '') +
            (entry.computer_type == 'All-In-One' ? '<p><b>Screen Condition: </b>' + entry.aio_screen_condition + '</p>' : '') +
            
            '<p><b>Operating System: </b>' + entry.os + '</p>' +
            '<p><b>Processor: </b>' + entry.cpu_brand + ' ' + entry.cpu_model + ' ' + (entry.cpu_speed >0 ? ' - ' + entry.cpu_speed.toFixed(1) + 'Ghz' : '(Unknown Speed)') + '</p>' +
            '<p><b>RAM Amount: </b>' + entry.ram + '</p>' +
            '<p><b>Hard Drive: </b>' + entry.hdd + ' ' + entry.hdd_type + '</p>' +
            '<p><b>Notes: </b>' + (entry.notes != null ? entry.notes : 'N/A') + '</p>' +
            '<p><b>Tech: </b>' + entry.tech + '</p>' +
        '</div>';
        let edit_data = 
        '<form id="system-edit-form-'+entry._id+'" onsubmit="return submitEdit(this)">' + 
            '<div id="system-modal-data-edit-'+entry._id+'" class="system-modal-data-edit" style="display: none;">' + 
                '<div class="system-modal-data-edit-left">' + 
                    '<p><b>Brand: </b><input name="edit-brand-'+entry._id+'" type="text" value="' + entry.brand + '" required></p>' +
                    '<p><b>Model: </b><input name="edit-model-'+entry._id+'" type="text" value="' + entry.model + '" required></p>' +
                    '<p><b>Cond: </b><input name="edit-condition-'+entry._id+'" type="text" value="' + entry.condition + '" required></p>' +
                    '<p><b>Computer Type: </b>' + 
                        '<select name="edit-computer-type-' + entry._id + '" onchange="selectEditOptions(this)">' + 
                            '<option value="Desktop" ' + (entry.computer_type == "Desktop" ? 'selected' : '') + '>Desktop</option>' + 
                            '<option value="Laptop" ' + (entry.computer_type == "Laptop" ? 'selected' : '') + '>Laptop</option>' + 
                            '<option value="All-In-One" ' + (entry.computer_type == "All-In-One" ? 'selected' : '') + '>All-In-One</option>' + 
                        '</select>' + 
                    '</p>' +

                    '<p ' + (entry.computer_type != 'Laptop' ? 'hidden' : '') + '><b>Screen Size: </b>' + 
                        '<select name="edit-laptop-screen-size-'+entry._id+'" required>' + 
                            '<option value=-11'+ (entry.laptop_screen_size == -11 ? ' selected ' : ' ') +'>less than 11in.</option>' +
                            '<option value=11'+ (entry.laptop_screen_size == 11 ? ' selected ' : ' ') +'>11 inches</option>'+
                            '<option value=13'+ (entry.laptop_screen_size == 13 ? ' selected ' : ' ') +'>13 inches</option>'+
                            '<option value=14'+ (entry.laptop_screen_size == 14 ? ' selected ' : ' ') +'>14 inches</option>'+
                            '<option value=15'+ (entry.laptop_screen_size == 15 ? ' selected ' : ' ') +'>15 inches</option>'+
                            '<option value=17'+ (entry.laptop_screen_size == 17 ? ' selected ' : ' ') +'>17 inches</option>'+
                            '<option value=18'+ (entry.laptop_screen_size == 19 ? ' selected ' : ' ') +'>18 inches</option>'+
                            '<option value=-100'+ (entry.laptop_screen_size == -100 ? ' selected ' : ' ') +'>greater than 18in.</option>'+
                            '<option value=-1 hidden '+ (entry.laptop_screen_size == -11 ? ' selected ' : ' ') +'>N/A</option>'+
                        '</select>' + 
                    '</p>' +
                    '<p ' + (entry.computer_type != 'Laptop' ? 'hidden' : '') + '><b>Screen Cond: </b><input name="edit-laptop-screen-condition-'+entry._id+'" type="text" value="' + entry.laptop_screen_condition + '" required></p>' +
                    '<p ' + (entry.computer_type != 'Desktop' ? 'hidden' : '') + '><b>Graphics: </b><input name="edit-desktop-graphics-'+entry._id+'" type="text" value="' + (entry.desktop_gpu_type != 'N/A' ? entry.desktop_gpu_type : '') + '" placeholder="Integrated or Dedicated" required></p>' +
                    '<p ' + (entry.computer_type != 'Desktop' ? 'hidden' : '') + '><b>Display Ports: </b><input name="edit-desktop-display-ports-'+entry._id+'" type="text" value="' + (entry.desktop_display_ports.length > 0 ? entry.desktop_display_ports : '') + '" placeholder="VGA,DVI,HDMI" required></p>' +
                    '<p ' + (entry.computer_type != 'All-In-One' ? 'hidden' : '') + '><b>Screen Size: </b>'+
                        '<select name="edit-aio-screen-size-'+entry._id+'" required>'+
                            '<option value=-19'+ (entry.aio_screen_size == -19 ? ' selected ' : ' ') +'>less than 19in.</option>' +
                            '<option value=19'+ (entry.aio_screen_size == 19 ? ' selected ' : ' ') +'>19 inches</option>' +
                            '<option value=20'+ (entry.aio_screen_size == 20 ? ' selected ' : ' ') +'>20 inches</option>' +
                            '<option value=21'+ (entry.aio_screen_size == 21 ? ' selected ' : ' ') +'>21 inches</option>' +
                            '<option value=22'+ (entry.aio_screen_size == 22 ? ' selected ' : ' ') +'>22 inches</option>' +
                            '<option value=23'+ (entry.aio_screen_size == 23 ? ' selected ' : ' ') +'>23 inches</option>' +
                            '<option value=24'+ (entry.aio_screen_size == 24 ? ' selected ' : ' ') +'>24 inches</option>' +
                            '<option value=25'+ (entry.aio_screen_size == 25 ? ' selected ' : ' ') +'>25 inches</option>' +
                            '<option value=26'+ (entry.aio_screen_size == 26 ? ' selected ' : ' ') +'>26 inches</option>' +
                            '<option value=27'+ (entry.aio_screen_size == 27 ? ' selected ' : ' ') +'>27 inches</option>' +
                            '<option value=28'+ (entry.aio_screen_size == 28 ? ' selected ' : ' ') +'>28 inches</option>' +
                            '<option value=29'+ (entry.aio_screen_size == 29 ? ' selected ' : ' ') +'>29 inches</option>' +
                            '<option value=30'+ (entry.aio_screen_size == 30 ? ' selected ' : ' ') +'>30 inches</option>' +
                            '<option value=31'+ (entry.aio_screen_size == 31 ? ' selected ' : ' ') +'>31 inches</option>' +
                            '<option value=32'+ (entry.aio_screen_size == 32 ? ' selected ' : ' ') +'>32 inches</option>' +
                            '<option value=33'+ (entry.aio_screen_size == 33 ? ' selected ' : ' ') +'>33 inches</option>' +
                            '<option value=34'+ (entry.aio_screen_size == 34 ? ' selected ' : ' ') +'>34 inches</option>' +
                            '<option value=-100'+ (entry.aio_screen_size == -100 ? ' selected ' : ' ') +'>greater than 34in.</option>' +
                            '<option value=-1 hidden >N/A</option>' +
                        '</select>' +
                    '</p>' +
                    '<p ' + (entry.computer_type != 'All-In-One' ? 'hidden' : '') + '><b>Screen Cond: </b><input name="edit-aio-screen-condition-'+entry._id+'" type="text" value="' + entry.aio_screen_condition + '" required></p>' +
                    
                    '<p><b>Op. System: </b><input name="edit-os-'+entry._id+'" type="text" value="' + entry.os + '" required></p>' +
                    //'<br><br><p><b>Tech: </b><input name="edit-tech-'+entry._id+'type="text" value="' + entry.tech + '" required></p>' +
                '</div>' + 
                '<div class="system-modal-data-edit-right">' + 
                    '<div class="system-edit-double">' + 
                        '<p><b>CPU Brand: </b><input name="edit-cpu-brand-'+entry._id+'"value="'+entry.cpu_brand+'" required></p>'+
                        '<p><b>CPU Model: </b><input name="edit-cpu-model-'+entry._id+'"value="'+entry.cpu_model+'" required></p>'+
                        '<p><b>CPU Speed: </b>' + 
                            '<select name="edit-cpu-speed-'+entry._id+'" required>' + 
                                '<option value="-1" '+ (entry.cpu_speed.toFixed(1) == -1.0 ? 'selected' : '') +' >Unknown</option>' + 
                                '<option value="1.0" '+ (entry.cpu_speed == 1.0 ? 'selected' : '') +' >1.0 Ghz</option>' + 
                                '<option value="1.1" '+ (entry.cpu_speed == 1.1 ? 'selected' : '') +' >1.1 Ghz</option>' + 
                                '<option value="1.2" '+ (entry.cpu_speed == 1.2 ? 'selected' : '') +' >1.2 Ghz</option>' + 
                                '<option value="1.3" '+ (entry.cpu_speed == 1.3 ? 'selected' : '') +' >1.3 Ghz</option>' + 
                                '<option value="1.4" '+ (entry.cpu_speed == 1.4 ? 'selected' : '') +' >1.4 Ghz</option>' + 
                                '<option value="1.5" '+ (entry.cpu_speed == 1.5 ? 'selected' : '') +' >1.5 Ghz</option>' + 
                                '<option value="1.6" '+ (entry.cpu_speed == 1.6 ? 'selected' : '') +' >1.6 Ghz</option>' + 
                                '<option value="1.7" '+ (entry.cpu_speed == 1.7 ? 'selected' : '') +' >1.7 Ghz</option>' + 
                                '<option value="1.8" '+ (entry.cpu_speed == 1.8 ? 'selected' : '') +' >1.8 Ghz</option>' + 
                                '<option value="1.9" '+ (entry.cpu_speed == 1.9 ? 'selected' : '') +' >1.9 Ghz</option>' + 
                                '<option value="2.0" '+ (entry.cpu_speed == 2.0 ? 'selected' : '') +' >2.0 Ghz</option>' + 
                                '<option value="2.1" '+ (entry.cpu_speed == 2.1 ? 'selected' : '') +' >2.1 Ghz</option>' + 
                                '<option value="2.2" '+ (entry.cpu_speed == 2.2 ? 'selected' : '') +' >2.2 Ghz</option>' + 
                                '<option value="2.3" '+ (entry.cpu_speed == 2.3 ? 'selected' : '') +' >2.3 Ghz</option>' + 
                                '<option value="2.4" '+ (entry.cpu_speed == 2.4 ? 'selected' : '') +' >2.4 Ghz</option>' + 
                                '<option value="2.5" '+ (entry.cpu_speed == 2.5 ? 'selected' : '') +' >2.5 Ghz</option>' + 
                                '<option value="2.6" '+ (entry.cpu_speed == 2.6 ? 'selected' : '') +' >2.6 Ghz</option>' + 
                                '<option value="2.7" '+ (entry.cpu_speed == 2.7 ? 'selected' : '') +' >2.7 Ghz</option>' + 
                                '<option value="2.8" '+ (entry.cpu_speed == 2.8 ? 'selected' : '') +' >2.8 Ghz</option>' + 
                                '<option value="2.9" '+ (entry.cpu_speed == 2.9 ? 'selected' : '') +' >2.9 Ghz</option>' + 
                                '<option value="3.0" '+ (entry.cpu_speed == 3.0 ? 'selected' : '') +' >3.0 Ghz</option>' + 
                                '<option value="3.1" '+ (entry.cpu_speed == 3.1 ? 'selected' : '') +' >3.1 Ghz</option>' + 
                                '<option value="3.2" '+ (entry.cpu_speed == 3.2 ? 'selected' : '') +' >3.2 Ghz</option>' + 
                                '<option value="3.3" '+ (entry.cpu_speed == 3.3 ? 'selected' : '') +' >3.3 Ghz</option>' + 
                                '<option value="3.4" '+ (entry.cpu_speed == 3.4 ? 'selected' : '') +' >3.4 Ghz</option>' + 
                                '<option value="3.5" '+ (entry.cpu_speed == 3.5 ? 'selected' : '') +' >3.5 Ghz</option>' + 
                                '<option value="3.6" '+ (entry.cpu_speed == 3.6 ? 'selected' : '') +' >3.6 Ghz</option>' + 
                                '<option value="3.7" '+ (entry.cpu_speed == 3.7 ? 'selected' : '') +' >3.7 Ghz</option>' + 
                                '<option value="3.8" '+ (entry.cpu_speed == 3.8 ? 'selected' : '') +' >3.8 Ghz</option>' + 
                                '<option value="3.9" '+ (entry.cpu_speed == 3.9 ? 'selected' : '') +' >3.9 Ghz</option>' + 
                                '<option value="4.0" '+ (entry.cpu_speed == 4.0 ? 'selected' : '') +' >4.0 Ghz</option>' + 
                                '<option value="4.1" '+ (entry.cpu_speed == 4.1 ? 'selected' : '') +' >4.1 Ghz</option>' + 
                                '<option value="4.2" '+ (entry.cpu_speed == 4.2 ? 'selected' : '') +' >4.2 Ghz</option>' + 
                                '<option value="4.3" '+ (entry.cpu_speed == 4.3 ? 'selected' : '') +' >4.3 Ghz</option>' + 
                                '<option value="4.4" '+ (entry.cpu_speed == 4.4 ? 'selected' : '') +' >4.4 Ghz</option>' + 
                                '<option value="4.5" '+ (entry.cpu_speed == 4.5 ? 'selected' : '') +' >4.5 Ghz</option>' + 
                                '<option value="4.6" '+ (entry.cpu_speed == 4.6 ? 'selected' : '') +' >4.6 Ghz</option>' + 
                                '<option value="4.7" '+ (entry.cpu_speed == 4.7 ? 'selected' : '') +' >4.7 Ghz</option>' + 
                                '<option value="4.8" '+ (entry.cpu_speed == 4.8 ? 'selected' : '') +' >4.8 Ghz</option>' + 
                                '<option value="4.9" '+ (entry.cpu_speed == 4.9 ? 'selected' : '') +' >4.9 Ghz</option>' + 
                                '<option value="5.0" '+ (entry.cpu_speed == 5.0 ? 'selected' : '') +' >5.0 Ghz</option>' + 
                            '</select>' +
                        '</p>'+
                        '<p><b>RAM Amount: </b>' + 
                            '<select name="edit-ram-'+entry._id+' type="text" required>'+
                                '<option value="N/A" '+(entry.ram === 'N/A' ? 'selected' : '')+'>N/A</option>' + 
                                '<option value="less than 1GB" '+(entry.ram === 'less than 1GB' ? 'selected' : '')+'>less than 1GB</option>' + 
                                '<option value="1GB" '+(entry.ram === '1GB' ? 'selected' : '')+'>1GB</option>' + 
                                '<option value="2GB" '+(entry.ram === '2GB' ? 'selected' : '')+'>2GB</option>' + 
                                '<option value="3GB" '+(entry.ram === '3GB' ? 'selected' : '')+'>3GB</option>' + 
                                '<option value="4GB" '+(entry.ram === '4GB' ? 'selected' : '')+'>4GB</option>' + 
                                '<option value="6GB" '+(entry.ram === '6GB' ? 'selected' : '')+'>6GB</option>' + 
                                '<option value="8GB" '+(entry.ram === '8GB' ? 'selected' : '')+'>8GB</option>' + 
                                '<option value="12GB" '+(entry.ram === '12GB' ? 'selected' : '')+'>12GB</option>' + 
                                '<option value="16GB" '+(entry.ram === '16GB' ? 'selected' : '')+'>16GB</option>' + 
                                '<option value="24GB" '+(entry.ram === '24GB' ? 'selected' : '')+'>24GB</option>' + 
                                '<option value="32GB" '+(entry.ram === '32GB' ? 'selected' : '')+'>32GB</option>' + 
                            '</select>' + 
                        '</p>' +
                        '<p><b>Hard Drive: </b>'+
                            '<select name="edit-hdd-'+entry._id+' type="text" value="' + entry.hdd + '" required>'+
                                '<option value="N/A">N/A</option>' + 
                                '<option value="80GB">80GB</option>' + 
                                '<option value="120GB">120GB</option>' + 
                                '<option value="160GB">160GB</option>' + 
                                '<option value="250GB">250GB</option>' + 
                                '<option value="320GB">320GB</option>' + 
                                '<option value="500GB">500GB</option>' + 
                                '<option value="640GB">640GB</option>' + 
                                '<option value="750GB">750GB</option>' + 
                                '<option value="1.0TB">1.0TB</option>' + 
                                '<option value="1.5TB">1.5TB</option>' + 
                                '<option value="2.0TB">2.0TB</option>' + 
                                '<option value="3.0TB">3.0TB</option>' + 
                                '<option value="4.0TB">4.0TB</option>' + 
                            '</select>' + 
                        '</p>' +
                        '<p><b>HDD Type: </b>'+
                            '<select name="edit-hdd-type-'+entry._id+' type="text" required>'+
                                '<option value="HDD" '+(entry.hdd_type == 'HDD' ? 'selected' : '')+'>HDD</option>' + 
                                '<option value="SSD" '+(entry.hdd_type == 'SSD' ? 'selected' : '')+'>SSD</option>' + 
                                '<option value="M.2 SSD" '+(entry.hdd_type == 'M.2 SSD' || entry.hdd_type == 'M.2 SATA' ? 'selected' : '')+'>M.2 SSD</option>' + 
                                '<option value="NVME" '+(entry.hdd_type == 'NVME' ? 'selected' : '')+'>NVME</option>' + 
                                '<option value="Embedded" '+(entry.hdd_type == 'Embedded' ? 'selected' : '')+'>Embedded</option>' + 
                            '</select>' + 
                        '</p>' +
                    '</div>' + 
                    '<p><b>Notes: </b><input name="edit-notes-'+entry._id+'" type="text" value="' + (!entry.notes ? '' : entry.notes) + '" placeholder="Bad Battery, Cracked Frame, etc"></p>' +
                    '<br><br><p><b>Tech: </b><input name="edit-tech-'+entry._id+'" type="text" value="' + entry.tech + '" required></p>' +
                '</div>' +
                //'<br><br><p><b>Tech: </b><input name="edit-tech-'+entry._id+'type="text" value="' + entry.tech + '" required></p>' + 
            '</div>' + 
            '<button type="submit" id="edit-button-submit-trigger-'+entry._id+'" style="visibility: hidden;">' + 
        '</form>';

        return static_data + edit_data;
    }

    //function for changing computer options based on computer type
    function selectEditOptions(element) {
        let id = element.name.replace('edit-computer-type-', '');
        console.log(id);
        switch (element.value) {
            case 'Desktop':
                document.getElementsByName('edit-laptop-screen-size-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-laptop-screen-condition-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-desktop-graphics-'+id)[0].parentElement.removeAttribute('hidden');
                document.getElementsByName('edit-desktop-display-ports-'+id)[0].parentElement.removeAttribute('hidden');
                document.getElementsByName('edit-aio-screen-size-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-aio-screen-condition-'+id)[0].parentElement.setAttribute('hidden', true);
                break;
            case 'Laptop':
                document.getElementsByName('edit-laptop-screen-size-'+id)[0].parentElement.removeAttribute('hidden');
                document.getElementsByName('edit-laptop-screen-condition-'+id)[0].parentElement.removeAttribute('hidden', true);
                document.getElementsByName('edit-desktop-graphics-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-desktop-display-ports-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-aio-screen-size-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-aio-screen-condition-'+id)[0].parentElement.setAttribute('hidden', true);
                break;
            case 'All-In-One':
                document.getElementsByName('edit-laptop-screen-size-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-laptop-screen-condition-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-desktop-graphics-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-desktop-display-ports-'+id)[0].parentElement.setAttribute('hidden', true);
                document.getElementsByName('edit-aio-screen-size-'+id)[0].parentElement.removeAttribute('hidden');
                document.getElementsByName('edit-aio-screen-condition-'+id)[0].parentElement.removeAttribute('hidden');
                break;
        }
    }

</script>

<!--EDIT SUBMISSION SCRIPT-->
<script>
    //submit edit function
    function submitEdit(formContainer) {
        //console.log('What is this? \n' + formContainer + '\n' + formContainer.id);
        //console.log('What is this? \n' + formContainer[0] + '\n' + formContainer[0].name);
        // for (let i = 0; i < formContainer.length; i++) {
        //     console.log('Element at ' + i + ': ' + formContainer[i].name);
        // }
        //return false;
        //get ID
        let systemId = formContainer.id.replace('system-edit-form-', "");
        let apiURL = 'http://localhost:5000/gcommlogs/' + systemId;
        // console.log('ID recieved: ' + systemId);
        // console.log('URL for PUT: ' + apiURL);

        //get display ports and store in array
        let displayPorts = [];
        formContainer[7].value
        .split(",")
        .forEach(element => displayPorts.push(element.trim()));

        //computer type
        let type = formContainer[3].value;

        //create submission JSON object
        let submission = {
            'brand': formContainer[0].value,
            'model': formContainer[1].value,
            'condition': formContainer[2].value,
            'computer_type': formContainer[3].value,
            'laptop_screen_size': (type != 'Laptop' ? -1 : formContainer[4].value),
            'laptop_screen_condition': (type != 'Laptop' ? 'N/A' : formContainer[5].value),
            'desktop_gpu_type': (type != 'Desktop' ? 'N/A' : formContainer[6].value),
            'desktop_display_ports': (type != 'Desktop' ? [] : displayPorts),
            'aio_screen_size': (type != 'All-In-One' ? -1 : formContainer[8].value),
            'aio_screen_condition': (type != 'All-In-One' ? 'N/A' : formContainer[9].value),
            'os': formContainer[10].value,
            'cpu_brand': formContainer[11].value,
            'cpu_model': formContainer[12].value,
            'cpu_speed': formContainer[13].value,
            'ram': formContainer[14].value,
            'hdd': formContainer[15].value,
            'hdd_type': formContainer[16].value,
            'notes': formContainer[17].value,
            'tech': formContainer[18].value
        }
        
        try {
            console.log('JSON Object: \n' + JSON.stringify(submission));
        } catch (error) {
            console.log('Could not create JSON object.');
            return false;
        } finally {
            //return false;
        }

        //API call to update
        fetch(apiURL, {method: 'PUT', body: JSON.stringify(submission)})
        .then(response => response.json())
        .then(data => {
            alert('Data updated successfully!');
            window.location.reload();
        })
        .catch(error => {
            console.log(error);
            alert(error);
        });

        //return false to prevent form post
        return false;
    }
</script>

<!--DELETE SYSTEM SCRIPT-->
<script>
    function deleteSystemLog(delete_btn) {
        let system_id = delete_btn.id.replace('edit-btn-delete-', "");
        //console.log('Delete Button Clicked. \nSystem ID: ' + system_id);
        if (confirm('Are you SURE you want to delete this log? This cannot be undone.')) {
            let system_id = delete_btn.id.replace('edit-btn-delete-', "");
            let apiURL = 'http://localhost:5000/gcommlogs/' + system_id;
            fetch(apiURL, {method: 'DELETE'})
            .then(response => {
                alert('Log deleted successfully');
                window.location.reload();
            })
            .catch(error => {
                alert(error)
            });
        } else {
            console.log('No!');
        }
    }
</script>
{% endblock %}